# 🎮 LinBot - AstrBot 游戏系统插件

[![Version](https://img.shields.io/badge/version-1.6.1-blue.svg)](https://github.com/yourusername/astrbot_plugin_linbot)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](LICENSE)
[![AstrBot](https://img.shields.io/badge/AstrBot->=3.5.0-orange.svg)](https://github.com/AstrBotDevs/AstrBot)

## 📖 插件简介

LinBot 是一个为 AstrBot 设计的全功能游戏生态系统插件，集成了外部插件帮助中心、服务器监控和完整的经济游戏系统。为用户提供丰富的互动体验和社交娱乐功能。

### ✨ 核心特色

- 🎯 **完整游戏系统**：签到、打工、银行、排行榜等经济系统
- 🔍 **智能插件帮助**：自动识别并展示所有外部插件信息
- 🖥️ **服务器监控**：实时监控服务器状态和性能指标
- 🎨 **精美图片输出**：专业的视觉设计和图片生成
- 💰 **经济生态**：完整的虚拟经济体系，包含货币、等级、VIP系统
- 🏆 **竞技排行**：多维度排行榜系统，展示用户成就

## 🎮 游戏系统功能

### 💰 经济系统
- **货币体系**：金币作为基础货币，支持赚取、消费、存储
- **银行系统**：存取款、利息计算、VIP特权、每日限额
- **等级系统**：经验值升级，解锁更多工作和特权

### 📅 签到系统
- **每日签到**：基础100金币 + 随机奖励(0-50金币)
- **连续奖励**：3天(+50)、7天(+200)、15天(+500)、30天(+1000)
- **防重复机制**：每天只能签到一次，智能连续计算

### 💼 工作系统
- **9种工作**：从搬砖到企业顾问，不同等级要求
- **工资体系**：基础工资 + 等级加成 + 幸运奖励
- **冷却时间**：1-8小时不同工作冷却，每日最多10次
- **经验奖励**：工作获得经验值，助力等级提升

### 🏆 排行榜系统
- **多类型排行**：金钱、总资产、等级、签到、累计收入
- **图片输出**：精美的可视化排行榜展示
- **用户头像**：动态生成彩色头像占位符
- **实时排名**：查看个人在各排行榜中的位置

### 👤 用户信息系统
- **个人面板**：财富状况、等级信息、签到统计
- **详细统计**：银行、工作、排名等多维度数据
- **活动记录**：最近操作历史追踪

### ⚔️ 抢劫系统
- **PVP对战**：玩家间财富争夺，增加竞技性
- **失败惩罚**：抢劫失败时扣除惩罚金额给被抢劫者
- **可配置参数**：成功率、金额范围、冷却时间、惩罚金额均可调整
- **保护机制**：新手保护，避免过度攻击
- **智能匹配**：精确和模糊用户名查找
- **命令优化**：支持 `/抢劫目标` 无空格输入方式

## 🏗️ 项目结构

```
astrbot_plugin_linbot/
├── main.py                    # 🚀 插件主入口文件
├── metadata.yaml              # 📋 插件元数据配置
├── requirements.txt           # 📦 Python依赖列表
├── _conf_schema.json          # ⚙️ UI配置模式定义
├── README.md                  # 📚 项目文档
├── CLAUDE.md                  # 🤖 AI开发文档
├── assets/                    # 🎨 静态资源目录
│   ├── LXGWWenKai-Regular.ttf # 🔤 中文字体文件
│   └── logo.png               # 🖼️ 插件Logo图标
├── helps/                     # 🛠️ 帮助功能模块
│   ├── __init__.py           # 📝 模块初始化
│   └── helps.py              # 🎯 帮助生成核心逻辑
├── server/                    # 🖥️ 服务器监控模块
│   ├── __init__.py           # 📝 模块初始化
│   └── monitor.py            # 📊 服务器监控逻辑
└── game/                      # 🎮 游戏系统模块
    ├── init_db.py            # 🗄️ 数据库初始化
    ├── user.db               # 📂 SQLite游戏数据库
    ├── log.md                # 📝 开发日志
    ├── qiandao/              # 📅 签到系统
    │   ├── __init__.py
    │   └── checkin_manager.py
    ├── mybag/                # 👤 用户信息系统
    │   ├── __init__.py
    │   └── user_info_manager.py
    ├── gzrw/                 # 💼 工作系统
    │   ├── __init__.py
    │   └── work_manager.py
    ├── bank/                 # 🏦 银行系统
    │   ├── __init__.py
    │   └── bank_manager.py
    ├── phb/                  # 🏆 排行榜系统
    │   ├── __init__.py
    │   └── ranking_manager.py
    └── qiangjie/             # ⚔️ 抢劫系统
        ├── __init__.py
        └── robbery_manager.py
```

## 🎯 指令大全

### 🔍 插件管理功能
```
/帮助           # 查看所有外部插件信息图谱
/linbot_config  # 打开插件配置管理界面
```

### 🖥️ 服务器监控功能
```
/服务器         # 查看服务器状态信息
/服务器 图表     # 查看CPU使用率趋势图
```

### 🎮 游戏系统功能

#### 📅 签到系统
```
/签到           # 每日签到领取奖励
/签到信息       # 查看签到统计和奖励预期
/签到排行       # 查看连续签到排行榜
```

#### 👤 用户信息
```
/我的信息       # 查看基本信息和排名概览
/我的详情       # 查看详细统计数据
/我的记录       # 查看最近活动历史
```

#### 💼 工作系统
```
/打工           # 查看工作列表
/打工 [工作名]  # 执行指定工作
/打工统计       # 查看工作统计信息
```

#### 🏦 银行系统
```
/银行           # 查看银行账户信息
/银行 存款 [金额] # 存入现金到银行
/银行 取款 [金额] # 从银行取出现金
```

#### 🏆 排行榜系统
```
/排行榜         # 查看金钱排行榜(默认)
/排行榜 [类型]  # 查看指定类型排行榜
/我的排名       # 查看个人在各排行榜的排名
```

#### ⚔️ 抢劫系统
```
/抢劫           # 查看抢劫信息和统计
/抢劫 目标       # 查看可抢劫的富豪榜
/抢劫目标        # 同上（无空格写法）
/抢劫 [用户名]  # 抢劫指定用户
```

*排行榜类型：金钱、资产、等级、签到、收入*

## 🚀 安装与配置

### 快速安装
1. 将插件目录放置到 `data/plugins/` 下
2. 重启 AstrBot 或重新加载插件
3. 发送 `/帮助` 开始使用

### 游戏数据库初始化
插件首次运行时会自动创建游戏数据库，包含以下数据表：
- **users** - 用户基础信息（金钱、等级、经验等）
- **checkin_records** - 签到记录
- **work_records** - 工作记录
- **bank_transactions** - 银行交易记录
- **robbery_records** - 抢劫记录
- **user_items** - 用户物品（预留）

### 配置选项
LinBot 提供 Web UI 配置界面：

#### 显示设置
- **每行指令数**：1-6个，调整帮助图片指令显示密度
- **显示插件头像**：开启/关闭插件Logo显示

#### 游戏系统设置
- **打工冷却时间倍数**：0.1-5.0，数值越小冷却越快（默认1.0）
- **银行基础利息率**：0.01-1.0%，普通用户日利率（默认0.1%）
- **VIP用户利息率**：0.01-2.0%，VIP用户日利率（默认0.15%）
- **VIP门槛金额**：1,000-100,000金币，升级VIP需要的存款（默认10,000）
- **每日打工次数限制**：1-50次，每日最多打工次数（默认10次）
- **打工经验倍数**：0.1-5.0，打工获得经验的倍数（默认1.0）
- **抢劫成功率**：10.0-80.0%，抢劫成功的概率（默认30.0%）
- **抢劫金额范围**：最小10-500，最大100-2000金币（默认50-300）
- **抢劫冷却时间**：1.0-24.0小时，抢劫操作冷却（默认6.0小时）
- **抢劫等级要求**：1-20级，进行抢劫的最低等级（默认5级）
- **抢劫保护金额**：0-1000金币，低于此金额不能被抢（默认100）
- **抢劫失败惩罚**：0-200金币，抢劫失败时扣除的金额（默认20）

## 🎮 游戏机制详解

### 💰 经济系统机制
- **基础货币**：金币，通过签到、工作等方式获得
- **银行利息**：可配置的日利率，普通用户和VIP用户享受不同利率
- **VIP系统**：存款达到可配置的门槛金额自动升级VIP，享受特权

### ⭐ 等级系统机制
- **分层升级**：1-5级(100经验)、6-10级(200经验)、11-15级(500经验)、16+级(1000经验)
- **等级特权**：解锁高薪工作、银行优惠等特殊功能

### ⚙️ 配置化游戏平衡
- **动态调整**：管理员可通过配置界面调整游戏参数
- **实时生效**：配置更改立即在游戏中生效
- **平衡控制**：可调整冷却时间、经验获得、利息率等核心参数

### ⚔️ 抢劫系统机制
- **等级门槛**：需要达到指定等级才能进行抢劫
- **成功率系统**：基于配置的概率决定抢劫成败
- **金额计算**：在配置范围内随机，不超过目标可抢金额
- **失败惩罚**：抢劫失败时扣除惩罚金额，转给被抢劫者作为补偿
- **保护机制**：现金低于保护金额的用户免受抢劫
- **冷却限制**：抢劫后需要等待指定时间才能再次抢劫
- **命令容错**：支持 `/抢劫目标` 和 `/抢劫 目标` 两种输入方式

### 💼 工作系统详解

| 工作名称 | 等级要求 | 基础工资 | 基础冷却时间* | 经验奖励** |
|---------|---------|---------|-------------|-----------|
| 搬砖 | 1级 | 80金币 | 1小时 | 10经验 |
| 送外卖 | 3级 | 120金币 | 2小时 | 15经验 |
| 便利店员 | 5级 | 150金币 | 2小时 | 20经验 |
| 快递员 | 8级 | 200金币 | 3小时 | 25经验 |
| 客服代表 | 10级 | 250金币 | 4小时 | 30经验 |
| 程序员 | 12级 | 500金币 | 6小时 | 50经验 |
| 设计师 | 15级 | 450金币 | 5小时 | 45经验 |
| 金融分析师 | 18级 | 800金币 | 8小时 | 80经验 |
| 企业顾问 | 20级 | 1000金币 | 8小时 | 100经验 |

*实际冷却时间 = 基础冷却时间 × 冷却时间倍数（可配置）  
**实际经验奖励 = 基础经验奖励 × 经验倍数（可配置）

## 🛠️ 技术特性

### 🎨 图片生成技术
- **PIL渲染引擎**：使用Pillow库生成高质量图片
- **中文字体支持**：LXGWWenKai-Regular.ttf专业中文字体
- **动态布局**：根据内容自动调整图片尺寸
- **头像系统**：用户名哈希生成唯一彩色头像

### 🗄️ 数据库设计
- **SQLite存储**：轻量级、高性能的本地数据库
- **事务安全**：完整的事务控制和自动回滚机制
- **索引优化**：7个性能优化索引，确保查询效率
- **数据完整性**：完善的约束和验证机制

### 🏗️ 架构设计
- **模块化设计**：各功能模块独立，便于维护和扩展
- **统一管理器**：每个游戏功能都有专门的管理器类
- **异常处理**：完善的错误捕获和用户友好的提示
- **AstrBot集成**：严格遵循AstrBot插件开发规范

### ⚙️ 配置系统
- **集中管理**：所有游戏参数集中在配置文件中
- **Web界面**：通过AstrBot配置界面轻松调整参数
- **动态更新**：配置更改立即生效，无需重启
- **类型安全**：完整的参数验证和类型检查

## 📊 性能特性

- ⚡ **高效查询**：优化的SQL查询，支持大用户量
- 🎨 **异步渲染**：图片生成不阻塞主线程
- 💾 **智能缓存**：合理的数据缓存策略
- 🔧 **错误恢复**：图片生成失败时自动降级为文本
- 📱 **响应式设计**：适配不同平台和屏幕尺寸

## 📋 更新日志

### v1.6.1 🔧 (当前版本)
- ⚔️ **抢劫系统优化**：修复关键问题，提升用户体验
- 💸 **失败惩罚机制**：抢劫失败时扣除惩罚金额给被抢劫者
- 🛠️ **命令修复**：修复 `/抢劫目标` 指令无法正常使用的问题
- 🎛️ **新增配置项**：可配置抢劫失败惩罚金额（默认20金币）
- 🔧 **容错改进**：支持 `/抢劫目标` 无空格输入方式
- 📊 **统计完善**：抢劫记录和统计信息更加详细准确

### v1.6.0 ⚔️
- 🏴‍☠️ **抢劫系统**：PVP财富争夺，增加游戏竞技性
- 🎛️ **可配置参数**：抢劫成功率、金额范围、冷却时间全可调
- 🛡️ **保护机制**：新手保护，防止过度攻击
- 🎯 **智能匹配**：支持精确和模糊用户名查找
- 📊 **完善统计**：抢劫成功率、收益损失等详细数据

### v1.5.0 ⚙️
- 🎛️ **配置系统集中化**：游戏参数统一配置管理
- 🔧 **动态参数调整**：打工冷却时间、银行利息率、经验倍数等可配置
- 📊 **实时显示更新**：游戏界面自动反映当前配置设置
- 🎮 **游戏平衡控制**：管理员可灵活调整游戏难度和节奏
- 🔄 **向后兼容**：所有配置项都有合理默认值

### v1.4.0 🎮
- 🎯 **完整游戏系统**：新增签到、工作、银行、排行榜系统
- 💰 **经济生态**：完整的虚拟经济体系和货币流通
- 🏆 **排行榜功能**：5种排行榜类型，图片输出展示
- 🏦 **银行系统**：存取款、VIP系统、利息计算
- 📊 **数据统计**：详细的用户数据分析和历史记录
- 🎨 **视觉升级**：全新的图片设计和用户界面

### v1.3.1
- 🎯 **简化配置**：移除前缀修改功能，跟随系统设置
- ⚙️ **保留UI配置**：每行指令数、插件头像显示设置

### v1.3.0
- 🎨 **新增UI配置**：Web界面可视化配置系统
- ⚙️ **自定义显示**：每行指令数(1-6)、头像显示开关

### v1.2.0
- 🔍 **真实指令**：从插件注册表提取真实指令
- 🎯 **智能过滤**：精准识别外部插件

### v1.1.0
- 🎨 **卡片布局**：现代化插件信息展示
- 🖼️ **Logo支持**：插件头像显示功能

### v1.0.0
- 🎉 **首个版本**：基础帮助图片生成

## 📝 系统要求

| 组件 | 最低版本 | 推荐版本 |
|------|----------|----------|
| Python | 3.7+ | 3.9+ |
| AstrBot | 3.5.0+ | 最新版 |
| Pillow | 8.0.0+ | 最新版 |

## 🔧 开发规范

本插件严格遵循 **AstrBot 开发文档** 标准：

- ✅ **标准API**：使用官方插件注册机制
- 📁 **数据规范**：遵循 `data/plugins_data/` 目录结构
- 🔄 **生命周期**：完整的加载、卸载管理
- 🛡️ **错误处理**：完善的异常捕获和日志记录
- 🏗️ **模块化**：清晰的代码结构和职责分离

## 💡 技术支持

### 🐛 问题反馈
- GitHub Issues：[提交问题](https://github.com/yourusername/astrbot_plugin_linbot/issues)
- 讨论区：[参与讨论](https://github.com/yourusername/astrbot_plugin_linbot/discussions)

### 📚 相关文档
- [AstrBot 官方文档](https://github.com/AstrBotDevs/AstrBot)
- [插件开发指南](https://github.com/AstrBotDevs/AstrBot/wiki)
- [游戏系统开发日志](game/log.md)

### 🤝 贡献代码
欢迎提交 Pull Request，让 LinBot 变得更好！

---

<div align="center">
  <strong>🎮 LinBot v1.6.1</strong><br>
  <em>不仅是插件助手，更是完整的游戏生态系统</em>
</div>